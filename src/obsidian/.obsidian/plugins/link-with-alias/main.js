/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var v=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var B=Object.prototype.hasOwnProperty;var J=(e,n)=>{for(var t in n)v(e,t,{get:n[t],enumerable:!0})},K=(e,n,t,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of H(n))!B.call(e,r)&&r!==t&&v(e,r,{get:()=>n[r],enumerable:!(i=G(n,r))||i.enumerable});return e};var Q=e=>K(v({},"__esModule",{value:!0}),e);var se={};J(se,{default:()=>b});module.exports=Q(se);var q=require("obsidian");var x=class{constructor(n){this.name=n;this.callbacks=[]}process(n){if(this.callbacks.length===0)return;let t=[...this.callbacks];this.callbacks.length=0,t.forEach(i=>{!i.destroyed&&i.callback(n)&&(i.destroyed||this.callbacks.push(i))})}register(n){let t={callback:n};return this.callbacks.push(t),()=>{t.destroyed=!0,this.callbacks.remove(t)}}};function L(e){return{line:e.line,ch:e.col}}function d(e,n){let t={line:e.line,ch:e.ch+n};if(t.ch<0)throw new Error("Negative col");return t}function f(e,n){let t={line:e.line,col:e.col+n,offset:e.offset+n};if(t.col<0)throw new Error("Negative col");return t}function h(e,n){let t=d(e.getCursor(),n);return e.setCursor(t),t}function R(e,n,t=!1,i=!1){if(t){if(C(e,n.start)<0)return!1}else if(C(e,n.start)<=0)return!1;if(i){if(C(e,n.end)>0)return!1}else if(C(e,n.end)>=0)return!1;return!0}function P(e){return"ch"in e?e.ch:e.col}function C(e,n){let t=e.line-n.line;return t!==0?t:P(e)-P(n)}function y(e,n){return e.line!==n.line?!1:P(e)==P(n)}var T=class{constructor(n,t=1e3){this.plugin=n;this.listenerRegistry=new x("EditorCursorListener");this.plugin.registerEvent(this.plugin.app.workspace.on("active-leaf-change",i=>{this.listenerRegistry.process({leaf:i})})),this.plugin.registerEvent(this.plugin.app.workspace.on("editor-change",(i,r)=>{this.listenerRegistry.process({file:r.file})})),this.plugin.registerInterval(window.setInterval(()=>this.onTimeInterval(),t))}onTimeInterval(){this.listenerRegistry.process({})}fireOnCursorChange(n,t){let i=X(n),r=n.getCursor();return this.listenerRegistry.register(({leaf:o,file:a})=>{if(a&&i.path!=a.path)return!0;if(o!=null)return t(void 0),!1;let s=n.getCursor();return!a&&y(s,r)?!0:(r=s,t(s))})}};function X(e){return e.editorComponent.file}function O(e){return e==null?[]:Array.isArray(e)?e:[e]}function U(e){return e.charAt(0).toUpperCase()+e.substring(1)}async function A(e){return new Promise(n=>setTimeout(n,e))}function z(e){return Y()-e.stat.ctime<50}function Y(){return new Date().getTime()}function Z(e){return"plugins"in e}function _(e,n){if(Z(e))return e.plugins.getPlugin(n)}var V=["aliases","alias"];async function W(e,n,t){await e.processFrontMatter(n,i=>{if(typeof i=="object"){let r=V.find(l=>i[l]!=null)||V[0],o=O(i[r]),a=[];if(t.forEach(l=>{let c=l.toLocaleLowerCase();o.some(u=>u.toLocaleLowerCase()==c)||a.push(l)}),a.length===0)return;let s=[...o,...a];s.sort((l,c)=>c.length-l.length),i[r]=s}})}var w="[[",F="]]",ee="|";function m(e,n){n||(n=e.getCursor());let t=e.getLine(n.line),i=n.ch;t.substring(i,i+2)==w&&(i+=2),t.charAt(i)=="]"&&i--;let r,o=te(t,i,u=>(r=u(2),r==F||r==w));if(o<0||r!=F)return;o+=F.length;let a,s=ie(t,i,u=>(a=u(2),a==F||a==w));if(s<0||a!=w)return;let l=t.substring(s,o),c=l.substring(2,l.length-2).split(ee);return{link:c[0],position:{start:{col:s,line:n.line,offset:-1},end:{col:o,line:n.line,offset:-1}},original:l,displayText:c[1]}}function te(e,n,t){let i=e.length,r=o=>e.substring(n,Math.min(n+o,i));for(;n<i;){if(t(r))return n;n++}return-1}function ie(e,n,t){let i=e.length,r=o=>e.substring(n,Math.min(n+o,i));for(;n>0;)if(n--,t(r))return n;return-1}function ne(e){return e.displayText!=null?{start:f(e.position.end,-e.displayText.length-3),end:f(e.position.end,-2)}:{start:f(e.position.end,-2),end:f(e.position.end,-2)}}function S(e,n,t){if(e.displayText!==t){let i=ne(e);n.replaceRange(t!=null?`|${t}`:"",L(i.start),L(i.end)),e.displayText=t}}var k=require("obsidian"),I={copyDisplayText:!0,capitalizeFileName:!0},E=class extends k.PluginSettingTab{constructor(t,i){super(t,i);this.plugin=i}display(){new k.Setting(this.containerEl).setName("Copy selected text as link file").setDesc("When selected then creates link `[[text|text]]`, otherwise `[[|text]]`.").addToggle(t=>{t.setValue(this.plugin.settings.copyDisplayText),t.onChange(i=>{this.plugin.settings.copyDisplayText=i,this.plugin.saveSettings()})}),new k.Setting(this.containerEl).setName("Capitalize link file name").setDesc("When selected then `text` creates link `[[Text|text]]`, otherwise `[[text|text]]`.").setDisabled(!this.plugin.settings.copyDisplayText).addToggle(t=>{t.setValue(this.plugin.settings.capitalizeFileName),t.onChange(i=>{this.plugin.settings.capitalizeFileName=i,this.plugin.saveSettings()})})}hide(){this.containerEl.empty()}};function $(e){let n=_(e,"templater-obsidian");return n?new N(n):void 0}var N=class{constructor(n){this.templaterPlugin=n}async waitUntilDone(){for(await A(400);this.templaterPlugin.templater.files_with_pending_templates.size>0;)await A(50)}};async function j(e,n,t){t=t||"/";let i=e.metadataCache.getFirstLinkpathDest(n,t);if(i)return i;let r=e.fileManager.getNewFileParent(t).path+"/"+n+".md";return e.vault.create(r,"")}function re(e){return typeof e=="object"&&e!=null&&"canvas"in e}function oe(e){return typeof e=="object"&&e!=null&&"node"in e?re(e.node):!1}var M=class{constructor(n,t,i,r,o,a){this.linkStart=n;this.file=t;this.editor=i;this.makeAlias=r;this.cacheLink=o;this.linkText=a;this.unregister=[]}register(n){return this.unregister.push(n),this}destroy(){this.unregister.forEach(n=>n()),this.unregister.length=0}},b=class extends q.Plugin{constructor(t,i){super(t,i);this.settings=I;this.editorCursorListener=new T(this)}async onload(){await this.loadSettings(),this.addCommand({id:"create-link-with-alias",name:"Create link with alias",icon:"bracket-glyph",editorCallback:(t,i)=>{this.createLinkFromSelection(this.getFileFromContext(i),t,t.getCursor(),{makeAlias:!0,pathFromText:this.settings.copyDisplayText})}}),this.addCommand({id:"create-link",name:"Create link",icon:"bracket-glyph",editorCallback:(t,i)=>{this.createLinkFromSelection(this.getFileFromContext(i),t,t.getCursor(),{makeAlias:!1,pathFromText:this.settings.copyDisplayText})}}),this.addCommand({id:"toggle-link-display-text",name:"Toggle link display text",icon:"link-2",editorCallback:(t,i)=>{this.toggleLinkTextFromSelection(this.getFileFromContext(i),t,t.getCursor())}}),this.addSettingTab(new E(this.app,this))}async loadSettings(){this.settings=Object.assign({},I,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}getFileFromContext(t){if(t.file)return t.file;oe(t)}createLinkFromSelection(t,i,r,o){let a=m(i,r);if(a!=null&&a.position.start.col!==r.ch){o.makeAlias&&this.addMissingAlias(a,t==null?void 0:t.path);return}let s=i.getSelection(),l,c;if(s=="")i.replaceSelection("[[]]"),l=d(h(i,-2),-2);else if(s.indexOf("|")>=0){let g=s.split("|");if(g.length>2)return;i.replaceSelection(`[[${s}]]`),l=d(h(i,-(g[1].length+3)),-(g[0].length+2)),c=g[1]}else o.pathFromText?(i.replaceSelection(`[[${this.capitalizeOptionally(s)}|${s}]]`),l=d(h(i,-(s.length+3)),-(s.length+2)),c=s):(i.replaceSelection(`[[|${s}]]`),l=d(h(i,-(s.length+3)),-2),c=s);this.linkInfo&&(this.linkInfo.destroy(),delete this.linkInfo);let u=m(i,r);if(!u)throw new Error("cannot find newly create link");let p=new M(l,t,i,o.makeAlias,u,c);p.register(this.editorCursorListener.fireOnCursorChange(i,g=>{var D;return g?this.handleChangeOnLastLink(i,p):(p.makeAlias&&this.addMissingAlias(p.cacheLink,(D=p.file)==null?void 0:D.path),!1)})),this.linkInfo=p}capitalizeOptionally(t){return this.settings.capitalizeFileName?U(t):t}toggleLinkTextFromSelection(t,i,r){let o=m(i,r);if(o!=null&&o.position.start.col!==r.ch){o.displayText==null?(i.setCursor({line:o.position.end.line,ch:o.position.end.col-2}),i.replaceSelection("|")):S(o,i,void 0);return}}handleChangeOnLastLink(t,i){var o;let r=m(t,i.linkStart);return r&&y(i.linkStart,r.position.start)?(i.cacheLink=r,R(i.editor.getCursor(),r.position)?(i.linkText=r.displayText,!0):(i.linkText&&S(r,t,i.linkText),i.makeAlias&&this.addMissingAlias(r,(o=i.file)==null?void 0:o.path),!0)):(i.destroy(),!1)}async addMissingAlias(t,i){if(!t.original.contains("|")||!t.displayText)return;let r=t.link;if(!r)return;let o=await j(this.app,r,i);if(z(o)){let a=$(this.app);a&&await a.waitUntilDone()}await W(this.app.fileManager,o,[t.displayText])}};

/* nosourcemap */