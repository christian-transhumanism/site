{% set latestPost = collections.post | reverse | first %}
{% set latestEp = podcast | first %}
{% set latestSub = substack | first %}
{% set vids = videos | take(4) %}
{% set hasPrimaryMedia = latestPost or latestEp or latestSub %}
{% if hasPrimaryMedia or (vids and vids.length) %}
<section class="container">
  {% if hasPrimaryMedia %}
  <div class="home-media-grid home-media-grid--primary">
    {% if latestPost %}
    <article class="home-card">
      <h3>Latest Blog</h3>
      {% if latestPost.data.image %}
        <a href="{{ latestPost.url }}" class="media-thumb">
            <img
            src="{{ latestPost.data.image | cdnImage('c_scale,w_420,f_auto,q_auto,dpr_auto') }}"
            srcset="{{ latestPost.data.image | cdnImage('c_scale,w_320,f_auto,q_auto,dpr_auto') }} 320w, {{ latestPost.data.image | cdnImage('c_scale,w_420,f_auto,q_auto,dpr_auto') }} 420w, {{ latestPost.data.image | cdnImage('c_scale,w_720,f_auto,q_auto,dpr_auto') }} 720w"
            sizes="(max-width: 576px) 100vw, 33vw"
            alt="{{ latestPost.data.title }}"
            loading="lazy">
        </a>
      {% endif %}
      <h4 class="home-item-title"><a href="{{ latestPost.url }}">{{ latestPost.data.title }}</a></h4>
      <p class="home-item-desc">{{ latestPost.templateContent | striptags | truncate(160, true, '…') }}</p>
      <p><a class="btn btn-default" href="/blog/">More Posts</a></p>
    </article>
    {% endif %}

    {% if latestSub %}
    <article class="home-card">
      <h3>Latest Substack</h3>
      {% if latestSub.image %}
        <a href="{{ latestSub.url }}" class="media-thumb" target="_blank" rel="noopener"><img src="{{ latestSub.image }}" alt="{{ latestSub.title }}" loading="lazy"></a>
      {% endif %}
      <h4 class="home-item-title"><a href="{{ latestSub.url }}" target="_blank" rel="noopener">{{ latestSub.title }}</a></h4>
      <p class="home-item-desc">{{ latestSub.content | striptags | truncate(160, true, '…') }}</p>
      <p><a class="btn btn-default" href="{{ latestSub.url }}" target="_blank" rel="noopener">Read on Substack</a></p>
    </article>
    {% endif %}

    {% if latestEp %}
    <article class="home-card">
      <h3>Latest Podcast</h3>
      {% if latestEp.itunes and latestEp.itunes.image %}
        <a href="/podcast/{{ (latestEp.guid | episodeNumberFromRSSGUID) | replace('/', '') }}/" class="media-thumb">
          <img
            src="{{ latestEp.itunes.image | cdnImage('c_fill,g_auto,w_420,h_420,f_auto,q_auto,dpr_auto') }}"
            srcset="{{ latestEp.itunes.image | cdnImage('c_fill,g_auto,w_320,h_320,f_auto,q_auto,dpr_auto') }} 320w, {{ latestEp.itunes.image | cdnImage('c_fill,g_auto,w_420,h_420,f_auto,q_auto,dpr_auto') }} 420w, {{ latestEp.itunes.image | cdnImage('c_fill,g_auto,w_720,h_720,f_auto,q_auto,dpr_auto') }} 720w"
            sizes="(max-width: 576px) 100vw, 33vw"
            alt="{{ latestEp.title }}"
            loading="lazy">
        </a>
      {% endif %}
      <h4 class="home-item-title"><a href="/podcast/{{ (latestEp.guid | episodeNumberFromRSSGUID) | replace('/', '') }}/">{{ latestEp.title }}</a></h4>
      <p class="home-item-desc">{{ latestEp.content | striptags | truncate(160, true, '…') }}</p>
      <p><a class="btn btn-default" href="/podcast/">All Episodes</a></p>
    </article>
    {% endif %}
  </div>
  {% endif %}

  {% if vids and vids.length %}
  <div class="home-media-videos">
    <h3 class="home-media-heading">Videos</h3>
    <div class="home-media-grid home-media-grid--videos">
      {% for v in vids %}
      <article class="home-card home-card--video">
        <a class="media-thumb" href="https://www.youtube.com/watch?v={{ v.id }}" target="_blank" rel="noopener">
          <img src="https://img.youtube.com/vi/{{ v.id }}/hqdefault.jpg" alt="{{ v.title }}" loading="lazy">
        </a>
        <h4 class="home-item-title"><a href="https://www.youtube.com/watch?v={{ v.id }}" target="_blank" rel="noopener">{{ v.title }}</a></h4>
        <p><a class="btn btn-default" href="https://www.youtube.com/watch?v={{ v.id }}" target="_blank" rel="noopener">Watch</a></p>
      </article>
      {% endfor %}
    </div>
    <p class="home-media-cta"><a class="btn btn-default" href="/videos/">More Videos</a></p>
  </div>
  {% endif %}
</section>
{% endif %}
