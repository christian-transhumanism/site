{%- comment -%}
Renders a small grid of related mission articles within the same section.
Usage: include with a section key (faith|theological|technological). If not
provided, it infers from page.url. Excludes the current page URL.
{%- endcomment -%}

{%- assign section = key -%}
{%- if not section or section == '' -%}
  {%- assign url = page.url -%}
  {%- if url contains '/mission/faith/' -%}
    {%- assign section = 'faith' -%}
  {%- elsif url contains '/mission/technological/' -%}
    {%- assign section = 'technological' -%}
  {%- elsif url contains '/mission/theological/' -%}
    {%- assign section = 'theological' -%}
  {%- endif -%}
{%- endif -%}

{%- assign list = missionArticles[section] -%}
{%- assign is_landing_page = false -%}
{%- if page and page.url -%}
  {%- if page.url == '/mission/faith/' or page.url == '/mission/technological/' or page.url == '/mission/theological/' -%}
    {%- assign is_landing_page = true -%}
  {%- endif -%}
{%- endif -%}
{%- if list and list.size > 0 and is_landing_page == false -%}
  <div class="related-mission">
    <h3 class="h5" style="margin-top:2rem;">More in {{ section | capitalize }}</h3>
    <div class="feature-grid">
      {%- assign count = 0 -%}
      {%- for item in list -%}
        {%- if item.url != page.url and count < 3 -%}
          {%- assign img_small = item.image | cdnImage: "c_fill,g_auto,f_auto,q_auto,w_320,h_140,dpr_auto" -%}
          {%- assign img_medium = item.image | cdnImage: "c_fill,g_auto,f_auto,q_auto,w_480,h_180,dpr_auto" -%}
          {%- assign img_large = item.image | cdnImage: "c_fill,g_auto,f_auto,q_auto,w_600,h_220,dpr_auto" -%}
          {%- assign img_xl = item.image | cdnImage: "c_fill,g_auto,f_auto,q_auto,w_900,h_330,dpr_auto" -%}
          <a class="feature-card" href="{{ item.url }}">
            <span class="feature-card__media">
              <img
                src="{{ img_large }}"
                srcset="{{ img_small }} 320w, {{ img_medium }} 480w, {{ img_large }} 600w, {{ img_xl }} 900w"
                sizes="(min-width: 1200px) 280px, (min-width: 992px) 240px, (min-width: 768px) 50vw, 100vw"
                alt="{{ item.title }}"
                loading="lazy"
                decoding="async"
              >
            </span>
            <span class="feature-card__body">
              <h4 class="feature-card__title">{{ item.title }}</h4>
            </span>
          </a>
          {%- assign count = count | plus: 1 -%}
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
{%- endif -%}
