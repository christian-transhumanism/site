{# Renders related mission articles for the same section (Nunjucks) #}
{% set section = key %}
{% if not section or section == '' %}
  {% set url = page.url %}
  {% if '/mission/faith/' in url %}
    {% set section = 'faith' %}
  {% elif '/mission/technological/' in url %}
    {% set section = 'technological' %}
  {% elif '/mission/theological/' in url %}
    {% set section = 'theological' %}
  {% endif %}
{% endif %}

{% set list = missionArticles[section] %}
{% set landingPages = ['/mission/faith/', '/mission/technological/', '/mission/theological/'] %}
{% set isLandingPage = page and page.url and page.url in landingPages %}
{% if list and list.length > 0 and not isLandingPage %}
  <div class="related-mission">
    <h3 class="h5" style="margin-top:2rem;">More in {{ section | capitalize }}</h3>
    <div class="feature-grid">
      {% set count = 0 %}
      {% for item in list %}
        {% if item.url != page.url and count < 3 %}
          {% set imgSmall = item.image | cdnImage("c_fill,g_auto,f_auto,q_auto,w_320,h_140,dpr_auto") %}
          {% set imgMedium = item.image | cdnImage("c_fill,g_auto,f_auto,q_auto,w_480,h_180,dpr_auto") %}
          {% set imgLarge = item.image | cdnImage("c_fill,g_auto,f_auto,q_auto,w_600,h_220,dpr_auto") %}
          {% set imgXL = item.image | cdnImage("c_fill,g_auto,f_auto,q_auto,w_900,h_330,dpr_auto") %}
          <a class="feature-card" href="{{ item.url }}">
            <span class="feature-card__media">
              <img
                src="{{ imgLarge }}"
                srcset="{{ imgSmall }} 320w, {{ imgMedium }} 480w, {{ imgLarge }} 600w, {{ imgXL }} 900w"
                sizes="(min-width: 1200px) 280px, (min-width: 992px) 240px, (min-width: 768px) 50vw, 100vw"
                alt="{{ item.title }}"
                loading="lazy"
                decoding="async"
              >
            </span>
            <span class="feature-card__body">
              <h4 class="feature-card__title">{{ item.title }}</h4>
            </span>
          </a>
          {% set count = count + 1 %}
        {% endif %}
      {% endfor %}
    </div>
  </div>
{% endif %}
